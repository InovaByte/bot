<html><head><base href="https://binance-futures-signal.app/"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Binance Futures Trading Signal Generator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #1a1a1a;
    color: #e0e0e0;
    margin: 0;
    padding: 20px;
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
    background-color: #2a2a2a;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 0 10px rgba(255,255,255,0.1);
  }
  h1, h2 {
    color: #f0b90b;
  }
  .chart {
    width: 100%;
    height: 400px;
    background-color: #333;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
  }
  .signal-box {
    background-color: #333;
    border: 1px solid #f0b90b;
    border-radius: 5px;
    padding: 15px;
    margin-top: 20px;
  }
  .btn {
    background-color: #f0b90b;
    color: #1a1a1a;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 20px;
    margin-right: 10px;
  }
  .btn:hover {
    background-color: #d4a303;
  }
  #coinSelector {
    position: relative;
    width: 200px;
    margin-bottom: 20px;
  }
  #selectedCoin {
    width: 100%;
    padding: 10px;
    background-color: #333;
    color: #e0e0e0;
    border: 1px solid #f0b90b;
    border-radius: 5px;
    cursor: pointer;
  }
  #coinList {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    max-height: 300px;
    overflow-y: auto;
    background-color: #333;
    border: 1px solid #f0b90b;
    border-top: none;
    border-radius: 0 0 5px 5px;
    z-index: 1000;
  }
  .coin-item {
    padding: 10px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .coin-item:hover {
    background-color: #444;
  }
  #autoSignalResult {
    margin-top: 20px;
    padding: 15px;
    background-color: #333;
    border-radius: 5px;
    border: 1px solid #f0b90b;
  }
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f0b90b;
    border-radius: 50%;
    border-top: 3px solid #2a2a2a;
    animation: spin 1s linear infinite;
    margin-left: 10px;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>Sinal de Entrada para Operações de Futuros na Binance</h1>
    
    <div id="coinSelector">
      <div id="selectedCoin" onclick="toggleCoinList()">Selecione uma moeda</div>
      <div id="coinList"></div>
    </div>
    
    <h2>Gráfico de 1 Hora</h2>
    <div class="chart" id="chart1h"></div>
    
    <h2>Gráfico de 4 Horas</h2>
    <div class="chart" id="chart4h"></div>
    
    <h2>Gráfico Diário</h2>
    <div class="chart" id="chart1d"></div>
    
    <div class="signal-box">
      <h2>Sinal de Entrada</h2>
      <p id="signal-text">Selecione uma moeda para gerar um sinal.</p>
      <p>Stop-Loss: <span id="stop-loss">-</span></p>
      <p>Take-Profit: <span id="take-profit">-</span></p>
    </div>
    
    <button class="btn" onclick="generateSignal()">Gerar Novo Sinal</button>
    <button class="btn" onclick="findAutoSignal()">Busca Automática de Sinais</button>
    
    <div id="autoSignalResult" style="display: none;">
      <h2>Resultado da Busca Automática</h2>
      <p id="autoSignalText"></p>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
let selectedCoinPair = '';
let charts = {};
const baseUrl = 'https://fapi.binance.com';
let allSymbols = [];

async function fetchCoinList() {
  try {
    const response = await axios.get(`${baseUrl}/fapi/v1/exchangeInfo`);
    allSymbols = response.data.symbols.filter(s => s.status === 'TRADING');
    const coinListElement = document.getElementById('coinList');
    allSymbols.forEach(symbol => {
      const coinItem = document.createElement('div');
      coinItem.classList.add('coin-item');
      coinItem.textContent = symbol.symbol;
      coinItem.onclick = () => selectCoin(symbol.symbol);
      coinListElement.appendChild(coinItem);
    });
  } catch (error) {
    console.error('Error fetching coin list:', error);
  }
}

function toggleCoinList() {
  const coinList = document.getElementById('coinList');
  coinList.style.display = coinList.style.display === 'none' ? 'block' : 'none';
}

function selectCoin(symbol) {
  selectedCoinPair = symbol;
  document.getElementById('selectedCoin').textContent = symbol;
  toggleCoinList();
  updateCharts();
}

async function fetchKlines(symbol, interval) {
  try {
    const response = await axios.get(`${baseUrl}/fapi/v1/klines`, {
      params: {
        symbol: symbol,
        interval: interval,
        limit: 100
      }
    });
    return response.data.map(candle => ({
      x: new Date(candle[0]),
      y: [parseFloat(candle[1]), parseFloat(candle[2]), parseFloat(candle[3]), parseFloat(candle[4])]
    }));
  } catch (error) {
    console.error(`Error fetching ${interval} klines:`, error);
    return [];
  }
}

function createChart(elementId, data, period) {
  const options = {
    series: [{
      data: data
    }],
    chart: {
      type: 'candlestick',
      height: 400
    },
    title: {
      text: `${selectedCoinPair} - Gráfico ${period}`,
      align: 'left',
      style: {
        color: '#f0b90b'
      }
    },
    xaxis: {
      type: 'datetime',
      labels: {
        style: {
          colors: '#e0e0e0'
        }
      }
    },
    yaxis: {
      tooltip: {
        enabled: true
      },
      labels: {
        style: {
          colors: '#e0e0e0'
        }
      }
    },
    theme: {
      mode: 'dark'
    }
  };

  if (charts[elementId]) {
    charts[elementId].updateOptions(options);
    charts[elementId].updateSeries([{data: data}]);
  } else {
    charts[elementId] = new ApexCharts(document.querySelector(`#${elementId}`), options);
    charts[elementId].render();
  }
}

async function updateCharts() {
  if (!selectedCoinPair) return;

  const data1h = await fetchKlines(selectedCoinPair, '1h');
  const data4h = await fetchKlines(selectedCoinPair, '4h');
  const data1d = await fetchKlines(selectedCoinPair, '1d');
  
  createChart('chart1h', data1h, '1h');
  createChart('chart4h', data4h, '4h');
  createChart('chart1d', data1d, '1d');
}

function calculateRSI(prices, period = 14) {
  const changes = prices.slice(1).map((price, index) => price - prices[index]);
  const gains = changes.map(change => change > 0 ? change : 0);
  const losses = changes.map(change => change < 0 ? -change : 0);

  let avgGain = gains.slice(0, period).reduce((a, b) => a + b) / period;
  let avgLoss = losses.slice(0, period).reduce((a, b) => a + b) / period;

  const rsiValues = [100 - (100 / (1 + avgGain / avgLoss))];

  for (let i = period; i < prices.length - 1; i++) {
    avgGain = (avgGain * (period - 1) + gains[i]) / period;
    avgLoss = (avgLoss * (period - 1) + losses[i]) / period;
    rsiValues.push(100 - (100 / (1 + avgGain / avgLoss)));
  }

  return rsiValues;
}

function calculateMACD(prices, fastPeriod = 12, slowPeriod = 26, signalPeriod = 9) {
  const ema = (period, values) => {
    const k = 2 / (period + 1);
    let ema = values[0];
    return values.map((price, i) => {
      if (i === 0) return ema;
      ema = (price * k) + (ema * (1 - k));
      return ema;
    });
  };

  const fastEMA = ema(fastPeriod, prices);
  const slowEMA = ema(slowPeriod, prices);
  const macdLine = fastEMA.map((fast, i) => fast - slowEMA[i]);
  const signalLine = ema(signalPeriod, macdLine);
  const histogram = macdLine.map((macd, i) => macd - signalLine[i]);

  return { macdLine, signalLine, histogram };
}

async function generateSignal() {
  if (!selectedCoinPair) {
    alert('Por favor, selecione uma moeda primeiro.');
    return;
  }

  const data1h = await fetchKlines(selectedCoinPair, '1h');
  const data4h = await fetchKlines(selectedCoinPair, '4h');
  const data1d = await fetchKlines(selectedCoinPair, '1d');

  const closePrices1h = data1h.map(candle => candle.y[3]);
  const closePrices4h = data4h.map(candle => candle.y[3]);
  const closePrices1d = data1d.map(candle => candle.y[3]);

  const rsi1h = calculateRSI(closePrices1h, 14);
  const macd1h = calculateMACD(closePrices1h, 12, 26, 9);

  const currentPrice = closePrices1h[closePrices1h.length - 1];
  const rsiValue = rsi1h[rsi1h.length - 1];
  const macdValue = macd1h.histogram[macd1h.histogram.length - 1];

  let signal = '';
  if (rsiValue < 30 && macdValue > 0) {
    signal = 'COMPRA';
  } else if (rsiValue > 70 && macdValue < 0) {
    signal = 'VENDA';
  } else {
    signal = 'NEUTRO';
  }

  const signalText = `${signal}: RSI(1h) = ${rsiValue.toFixed(2)}, MACD(1h) histogram = ${macdValue.toFixed(5)}`;
  document.getElementById('signal-text').innerText = signalText;

  const stopLoss = signal === 'COMPRA' ? currentPrice * 0.98 : currentPrice * 1.02;
  const takeProfit = signal === 'COMPRA' ? currentPrice * 1.05 : currentPrice * 0.95;

  document.getElementById('stop-loss').innerText = `$${stopLoss.toFixed(2)}`;
  document.getElementById('take-profit').innerText = `$${takeProfit.toFixed(2)}`;
}

async function findAutoSignal() {
  const autoSignalResult = document.getElementById('autoSignalResult');
  const autoSignalText = document.getElementById('autoSignalText');
  
  autoSignalResult.style.display = 'block';
  autoSignalText.innerHTML = 'Buscando sinais... <div class="loading"></div>';

  const strongSignals = [];

  for (const symbol of allSymbols) {
    const data1h = await fetchKlines(symbol.symbol, '1h');
    const closePrices1h = data1h.map(candle => candle.y[3]);
    
    const rsi1h = calculateRSI(closePrices1h, 14);
    const macd1h = calculateMACD(closePrices1h, 12, 26, 9);

    const rsiValue = rsi1h[rsi1h.length - 1];
    const macdValue = macd1h.histogram[macd1h.histogram.length - 1];

    if ((rsiValue < 30 && macdValue > 0) || (rsiValue > 70 && macdValue < 0)) {
      strongSignals.push({
        symbol: symbol.symbol,
        rsi: rsiValue,
        macd: macdValue,
        signal: rsiValue < 30 ? 'COMPRA' : 'VENDA'
      });
    }

    if (strongSignals.length >= 5) break;
  }

  if (strongSignals.length > 0) {
    let resultHTML = '<ul>';
    strongSignals.forEach(signal => {
      resultHTML += `<li>${signal.symbol}: ${signal.signal} (RSI: ${signal.rsi.toFixed(2)}, MACD: ${signal.macd.toFixed(5)})</li>`;
    });
    resultHTML += '</ul>';
    autoSignalText.innerHTML = `Sinais fortes encontrados:<br>${resultHTML}`;
  } else {
    autoSignalText.innerText = 'Nenhum sinal forte encontrado no momento.';
  }
}

// Inicialização
window.onload = function() {
  fetchCoinList();
  document.addEventListener('click', function(event) {
    const coinSelector = document.getElementById('coinSelector');
    const coinList = document.getElementById('coinList');
    if (!coinSelector.contains(event.target)) {
      coinList.style.display = 'none';
    }
  });
};
</script>
</body></html>
